<ngx-spinner bdColor="rgba(51, 51, 51, 0.8)" color="#fff" size="large" type="ball-elastic-dots"></ngx-spinner>

<div class="container container-fluid">
  <h1 style="text-align: center"> Checkout</h1>
  <br/>

  <p-panel [toggleable]="true" header="Review Items">
    <div *ngIf="cartDataAvailable()" class="table-responsive-sm table-responsive-xs table-responsive-md table-responsive-lg">
      <table class="table">
        <thead style="text-align: center">
        <tr>
          <th scope="col">#</th>
          <th scope="col">Product</th>
          <th scope="col">Quantity</th>
          <th scope="col">Cost</th>
          <th scope="col"></th>
        </tr>
        </thead>
        <tbody style="text-align: center">
        <tr *ngFor="let cartProduct of (cart.cartProducts); index as i">
          <th scope="row">{{i + 1}}</th>
          <td><a [routerLink]="['/product', cartProduct.product.id]">{{cartProduct.product.name}}</a></td>
          <td>{{cartProduct.quantity}}</td>
          <td>{{cartProduct.product.price.currency.symbol}} {{cartProduct.quantity * cartProduct.product.price.amount}}</td>
        </tr>
        </tbody>
        <tfoot style="text-align: center">
        <tr>
          <td></td>
          <td></td>
          <td></td>
          <th>Tax = ${{totalCost.toPrecision(6)}}</th>
        </tr>
        <tr>
          <td></td>
          <td></td>
          <td></td>
          <th><h5>Total Cost = ${{totalCost.toPrecision(6)}}</h5></th>
        </tr>
        </tfoot>
      </table>
    </div>
  </p-panel>
  <br/>

  <!-- Shipping Address -->
  <div class="card border-info">
    <div class="card-header"> Shipping Address </div>
    <div class="card-body">
      <div class="table-responsive-sm table-responsive-xs table-responsive-md table-responsive-lg">
        <div *ngIf="addressesAvailable()">
          <div *ngFor="let address of addresses" class="row">
            <div class="col-6">
              <div class="form-check" style="margin: 10px">
                <label class="form-check-label" style="font-weight: bold">
                  <input class="form-check-input" name="shippingAddress" type="radio" value="{{address}}">{{address.addressType.type}}
                </label>
              </div>
              <address style="margin-left: 20px">
                {{address.streetName}}<br>
                Apt {{address.apartment}}<br>
                {{address.city.name}}, {{address.state.name}} - {{address.zipCode}}<br>
              </address>
              <br>
            </div>
            <div class="col-6">
              <input (click)="updateAddress(address)" class=" btn btn-primary" style="margin: 10px" type="button" value="Edit">
              <input (click)="deleteAddress(address)" class=" btn btn-danger" style="margin: 10px" type="button" value="Delete">
            </div>
          </div>

        </div>
        <div class="card-footer">
          <input (click)="createNewAddressDialog()" class=" btn btn-primary" style="margin: 10px" type="button" value="Create New">
        </div>
      </div>
    </div>
  </div>
  <br/>


  <!-- Billing Address -->
  <div class="card border-info">
    <div class="card-header"> Shipping Address </div>
    <div class="card-body">
    <div class="table-responsive-sm table-responsive-xs table-responsive-md table-responsive-lg">
      <div *ngIf="addressesAvailable()">
        <div *ngFor="let address of addresses" class="row">
          <div class="col-6">
            <div class="form-check" style="margin: 10px">
              <label class="form-check-label" style="font-weight: bold">
                <input class="form-check-input" name="billingAddress" type="radio" value="{{address}}" (click)="hideShippingAddressEditAndDelete()">{{address.addressType.type}}
              </label>
            </div>
            <address style="margin: 10px">
              {{address.streetName}}<br>
              Apt {{address.apartment}}<br>
              {{address.city.name}}, {{address.state.name}} - {{address.zipCode}}<br>
            </address>
          </div>
          <div class="col-6" *ngIf="!billingAddressRadioButtonSelected">
            <input (click)="updateAddress(address)" class=" btn btn-primary" style="margin: 10px" type="button" value="Edit">
            <input (click)="deleteAddress(address)" class=" btn btn-danger" style="margin: 10px" type="button" value="Delete">
          </div>
          <br>
        </div>
      </div>
      <input (click)="createNewAddressDialog()" class=" btn btn-primary" type="button" style="margin: 10px" value="Create New">
    </div>
    </div>
  </div>

  <!-- Address Modal-->
  <p-dialog [(visible)]="displayAddressDialog" [modal]="true" [responsive]="true" [style]="{minWidth: '400px'}"
            [closable]="true" [maximizable]="true" [resizable]="true" [baseZIndex]="10000"  [minY]="70" >
    <p-header>
      New Address
    </p-header>
    <div>
      <form [formGroup]="addressForm">
        <div class="form-group">
          <label>Address Type
            <select [compareWith]="compareAddressTypeFn" class="form-control" name="addressType" formControlName="addressType">
              <option  [ngValue]="addressType" *ngFor="let addressType of addressTypes">
                {{addressType.type}}
              </option>
            </select>
          </label>
        </div>

        <div class="form-row">
          <div class="col-auto">
            <label for="streetName">Street Name</label>
            <input type="text" class="form-control" formControlName="streetName" id="streetName" placeholder="Enter Street Name" required>
          </div>
        </div>
        <div class="form-row">
          <div class="col-auto">
            <label for="apartment">Apartment</label>
            <input type="text" class="form-control" formControlName="apartment" id="apartment" placeholder="Enter Apartment Number" required>
          </div>
        </div>
        <div class="form-row">
          <div class="col-auto">
          <label>Country
            <select  [compareWith]="compareCountryFn"  class="form-control" name="country" formControlName="country"  (change)="loadStates()">
              <option  [ngValue]="country" *ngFor="let country of countries">
                {{country.name}}
              </option>
            </select>
          </label>
          </div>
        </div>
        <div class="form-row">
          <div class="col-auto">
          <label>State
            <select  [compareWith]="compareStateFn"  class="form-control" name="state" formControlName="state"  (change)="loadCities()">
              <option  [ngValue]="state" *ngFor="let state of states">
                {{state.name}}
              </option>
            </select>
          </label>
        </div>
        </div>

        <div class="form-row">
          <div class="col-auto">
          <label>City
            <select  [compareWith]="compareCityFn"  class="form-control" name="city" formControlName="city">
              <option  [ngValue]="city" *ngFor="let city of cities">
                {{city.name}}
              </option>
            </select>
          </label>
          </div>
        </div>
        <div class="form-row">
          <div class="col-auto">
          <label for="zipCode">Zip Code</label>
          <input type="text" class="form-control" formControlName="zipCode" id="zipCode" placeholder="Enter Zip Code" required>
        </div>
        </div>
      </form>
    </div>
    <p-footer>
      <button type="button" pButton icon="pi pi-check" (click)="createNewAddress()" label="Create"></button>
      <button type="button" pButton icon="pi pi-close"  (click)="hideNewAddressDialog()" label="Cancel" class="ui-button-secondary"></button>
    </p-footer>
  </p-dialog>


  <br/>
    <p style="text-align: center">
      <input (click)="backToCart()" class=" btn btn-primary" style="margin: 40px" type="button" value="Back to Cart">
      <input (click)="placeOrder()" class=" btn btn-primary" style="margin: 20px" type="button" value="Placer Order">
    </p>
</div>
